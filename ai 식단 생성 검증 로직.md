# 골든셋 기반 생성 + 이중 검증 요약 (간단 버전)

> 팀 상황: 비전공 초보 5인, 복잡도 낮게/빠르게 실전 적용
> 핵심 전략: **⑥ 골든셋 변형만 허용 + ⑦ 이중 LLM(생성→심사)** 를 기본으로, **응답속도는 단일 호출(Self-Critique) + 룰엔진 선필터**로 해결

---

## 1) 골든셋(Golden Set)란?

* **정의**: 키토 규칙·현실성·맛 검토를 마친 **표준 레시피/식단 모음(30~100개)**
* **목적**: AI가 **골든셋을 베이스로 재료 치환/양 조정만** 하게 하여 **안전성/일관성** 확보
* **구성 요소**: 정규화 재료(name_norm + g), 3~5단계 조리, 기본 매크로(탄·단·지·kcal), 태그(카테고리/시간/도구)

### 골든셋 제작 절차(요약)

1. 카테고리·목표 개수 확정(5×6=30개 등)
2. 후보 수집(키토 친화 조합 위주)
3. **name_norm 사전** 만들기(영문소문자_언더스코어)
4. 표준 입력(재료 g 단위, 단계 3~5)
5. 공통 **금지/치환/양범위** 규칙 세트 정의
6. 체크리스트 1차 검증(금지어 0, 탄수 추정 ≤15g, 현실성 OK)
7. DB 적재 및 태깅

---

## 2) 적용 전략(6+7 조합)

* **6. 골든셋 변형만 허용**:

  * 허용 연산 = `swap(치환)` / `scale(양 조정)`
  * 금지 재료·알레르기·기피어·양 범위 **반드시 준수**
* **7. 이중 LLM(생성→심사)**:

  * A: 생성(골든셋 기반 변형)
  * B: 체크리스트 심사(금지어, swap/scale만 여부, 양 범위, 탄수 추정, 스키마 준수)
  * 필요 시 **자기수정 루프 ≤ 2회**

### 기대 효과 & 한계

* **장점**: 정확도/안전성↑, 포맷 일관성↑, 구현 난이도 중간
* **한계**: 다양성 제한(골든셋 밖 확장 어려움), 큐레이션/유지보수 비용

---

## 3) 최소 데이터 구조(개념)

* **golden_recipes**: 표준 레시피(정규화 재료·단계·태그·매크로)
* **transform_rules**: 치환 규칙, 양 범위, 금지 재료(공통+개별)
* **generated_recipes**: 생성 결과, 델타(치환/스케일), 심사 리포트, 통과 여부

---

## 4) 엔드투엔드 파이프라인(개념)

1. **선택**: 사용자 조건으로 골든셋 후보 Top-N 선택
2. **생성**: 골든셋 기반으로 **치환/양 조정만** 수행
3. **검증**: 체크리스트 심사(실패 시 수정 제안 → 재시도 ≤ 2회)
4. **저장/응답**: deltas/리포트/통과여부 기록, 사용자에 결과 전송

---

## 5) 응답속도 문제 해결(핵심 요약)

* **단일 호출(Self-Critique)**: 한 번의 LLM 응답에 **레시피 + 자기검토 체크리스트**를 함께 내도록 스키마화
* **룰엔진 선필터**: 금지어/양범위/스키마는 **코드로 즉시 검사** → 통과 시 별도 심사 생략
* **조건부 심사(Judge 경량화)**: 경계값·애매 케이스에서만 **소형 모델로 짧게** 체크
* **시간 예산**: 타임아웃·재시도 상한(생성 1회, 심사 0~1회)
* **스트리밍/배지**: 레시피 먼저 표시 → 수 초 후 “검증됨” 배지 갱신
* **캐싱**: (base_id, rules_hash, constraints_hash) 키로 **중복 요청 재사용**

---

## 6) 운영 규칙(간단)

* **정규화 이름(name_norm) 표** 팀 공용 관리(동의어·한영 표기 포함)
* **금지어 리스트** 공통화(예: sugar, honey, rice, wheat_flour, noodle_wheat 등)
* **양 범위** 핵심 재료 위주로 설정(예: olive_oil 5~25g)
* **로그 필수**: 실패 사유·수정 제안 저장 → 주간 개선 루프

---

## 7) 품질 게이트 & DoD(간단)

* **목표 지표**

  * 금지어 위반률 0%
  * 스키마 오류 0건
  * 재시도 ≤2회 내 통과율 ≥90%
* **릴리즈 DoD**

  * 골든셋 30개 + 공통 규칙 1세트 준비
  * 단일 호출 + 룰엔진 선필터 동작
  * 50건 샘플 테스트에서 목표 지표 달성

---

## 8) 빠른 제작 플랜(1~2일)

* **Day 1**: 카테고리 확정 → 후보 수집 → name_norm 사전 → 30개 표준화
* **Day 2**: 금지/치환/양범위 규칙 세트 → 파이프라인 연결(선택→생성→검증→저장) → 20~50건 샘플 테스트

---

### 최종 한 줄

**“골든셋 변형 + 자기검토 단일 호출 + 룰엔진 선필터(조건부 경량 심사)”** 조합이면, **품질과 속도**를 동시에 잡으면서 우리 팀 역량으로 **즉시 운영 가능한 수준**을 만들 수 있다.
