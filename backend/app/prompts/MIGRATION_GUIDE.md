# 🔄 기존 프롬프트를 새 시스템으로 마이그레이션 가이드

## 📋 개요

기존 프롬프트 파일들을 새로운 공통 템플릿 시스템으로 마이그레이션하는 단계별 가이드입니다.

## 🎯 마이그레이션 체크리스트

- [ ] 기존 프롬프트 파일 확인
- [ ] 공통 템플릿 import 추가
- [ ] 중복 코드 제거
- [ ] 기본 프롬프트만 남기기
- [ ] 공통 템플릿 적용
- [ ] 테스트 및 검증

## 📝 단계별 마이그레이션

### Step 1: 기존 프롬프트 분석

#### Before (기존 프롬프트)
```python
# app/prompts/chat/old_prompt.py
OLD_PROMPT = """
키토 식단 전문가로서 다음 질문에 친근하고 도움이 되는 답변을 해주세요.

질문: {message}
사용자 프로필: {profile_context}

답변 가이드라인:
1. 키토 식단 관련 질문에는 과학적이고 실용적인 조언 제공
2. 일반적인 인사나 대화에는 친근하게 응답하되 키토 주제로 자연스럽게 유도
3. 구체적인 레시피나 식당을 요청하면 전문 검색 서비스 이용을 안내
4. 개인의 건강 상태에 대한 의학적 조언은 피하고 전문의 상담 권유
5. 200-300자 내외로 간결하고 이해하기 쉽게 답변

마크다운 포맷팅 규칙:
- 번호 목록 사용 시: "1. 제목:" (번호와 제목 사이에 공백 없음)
- 하위 목록은 바로 다음 줄에: "- 항목1" (제목과 하위 목록 사이에 빈 줄 없음)
- 예시:
  1. 곡물류:
  - 쌀, 밀, 보리 등
  2. 단백질:
  - 고기, 생선, 계란 등

특별한 경우 처리:
- "안녕", "안녕하세요" 등 인사: 친근한 인사 후 키토 식단 도움 제안
- "고마워", "감사해" 등 감사 인사: 따뜻한 응답 후 추가 도움 제안  
- "해볼게", "좋네" 등 모호한 대답: 구체적인 키토 관련 질문 유도
- 키토와 무관한 질문: 정중히 키토 식단 전문가임을 알리고 관련 질문 유도

친근하고 격려하는 톤으로 답변해주세요.
"""
```

### Step 2: 공통 요소 식별

기존 프롬프트에서 공통 템플릿으로 처리할 수 있는 부분들을 찾습니다:

#### 🔄 공통 요소 (제거할 부분)
- ✅ "키토 식단 전문가로서" → `KETO_EXPERT_ROLE`
- ✅ "답변 가이드라인: 1-5번" → `DEFAULT_RESPONSE_GUIDELINES`
- ✅ "마크다운 포맷팅 규칙" → `MARKDOWN_FORMATTING_RULES`
- ✅ "친근하고 격려하는 톤으로 답변해주세요" → `FRIENDLY_TONE_GUIDE`

#### 🎯 고유 요소 (유지할 부분)
- 질문: {message}
- 사용자 프로필: {profile_context}
- 특별한 경우 처리 (인사, 감사 인사 등)

### Step 3: 마이그레이션 실행

#### After (새로운 프롬프트)
```python
# app/prompts/chat/new_prompt.py
from app.prompts.shared.common_templates import create_standard_prompt

# 기본 프롬프트만 정의 (공통 요소는 자동 적용됨)
_base_prompt = """
다음 질문에 친근하고 도움이 되는 답변을 해주세요.

질문: {message}
사용자 프로필: {profile_context}

특별한 경우 처리:
- "안녕", "안녕하세요" 등 인사: 친근한 인사 후 키토 식단 도움 제안
- "고마워", "감사해" 등 감사 인사: 따뜻한 응답 후 추가 도움 제안  
- "해볼게", "좋네" 등 모호한 대답: 구체적인 키토 관련 질문 유도
- 키토와 무관한 질문: 정중히 키토 식단 전문가임을 알리고 관련 질문 유도
"""

# 공통 템플릿 적용
NEW_PROMPT = create_standard_prompt(_base_prompt)
```

## 🔍 마이그레이션 예제들

### 예제 1: 채팅 프롬프트

#### Before
```python
GENERAL_CHAT_PROMPT = """
키토 식단 전문가로서 다음 질문에 친근하고 도움이 되는 답변을 해주세요.

질문: {message}
사용자 프로필: {profile_context}

답변 가이드라인:
1. 키토 식단 관련 질문에는 과학적이고 실용적인 조언 제공
2. 일반적인 인사나 대화에는 친근하게 응답하되 키토 주제로 자연스럽게 유도
3. 구체적인 레시피나 식당을 요청하면 전문 검색 서비스 이용을 안내
4. 개인의 건강 상태에 대한 의학적 조언은 피하고 전문의 상담 권유
5. 200-300자 내외로 간결하고 이해하기 쉽게 답변

마크다운 포맷팅 규칙:
- 번호 목록 사용 시: "1. 제목:" (번호와 제목 사이에 공백 없음)
- 하위 목록은 바로 다음 줄에: "- 항목1" (제목과 하위 목록 사이에 빈 줄 없음)
- 예시:
  1. 곡물류:
  - 쌀, 밀, 보리 등
  2. 단백질:
  - 고기, 생선, 계란 등

특별한 경우 처리:
- "안녕", "안녕하세요" 등 인사: 친근한 인사 후 키토 식단 도움 제안
- "고마워", "감사해" 등 감사 인사: 따뜻한 응답 후 추가 도움 제안  
- "해볼게", "좋네" 등 모호한 대답: 구체적인 키토 관련 질문 유도
- 키토와 무관한 질문: 정중히 키토 식단 전문가임을 알리고 관련 질문 유도

친근하고 격려하는 톤으로 답변해주세요.
"""
```

#### After
```python
from app.prompts.shared.common_templates import create_standard_prompt

_base_prompt = """
다음 질문에 친근하고 도움이 되는 답변을 해주세요.

질문: {message}
사용자 프로필: {profile_context}

특별한 경우 처리:
- "안녕", "안녕하세요" 등 인사: 친근한 인사 후 키토 식단 도움 제안
- "고마워", "감사해" 등 감사 인사: 따뜻한 응답 후 추가 도움 제안  
- "해볼게", "좋네" 등 모호한 대답: 구체적인 키토 관련 질문 유도
- 키토와 무관한 질문: 정중히 키토 식단 전문가임을 알리고 관련 질문 유도
"""

GENERAL_CHAT_PROMPT = create_standard_prompt(_base_prompt)
```

### 예제 2: 레시피 프롬프트

#### Before
```python
RECIPE_RESPONSE_GENERATION_PROMPT = """
키토 식단 전문가로서 사용자의 레시피 요청에 답변해주세요.
반드시 답변의 끝마다 냥체를 붙여서 답변해주세요

사용자 요청: {message}
검색된 레시피 정보: {context}

다음 형식으로 답변해주세요:

## 🍽️ 추천 키토 레시피
위에서 검색된 레시피들을 바탕으로 키토 식단에 적합한 레시피를 추천드립니다.

### 💡 키토 팁
- 탄수화물 함량을 확인하세요
- 충분한 지방 섭취를 유지하세요
- 개인 취향에 맞게 조절하세요

마크다운 포맷팅 규칙:
- 번호 목록 사용 시: "1. 제목:" (번호와 제목 사이에 공백 없음)
- 하위 목록은 바로 다음 줄에: "- 항목1" (제목과 하위 목록 사이에 빈 줄 없음)
- 예시:
  1. 곡물류:
  - 쌀, 밀, 보리 등
  2. 단백질:
  - 고기, 생선, 계란 등

더 자세한 정보가 필요하시면 언제든 말씀해주세요!
"""
```

#### After
```python
from app.prompts.shared.common_templates import create_standard_prompt

_base_recipe_prompt = """
사용자의 레시피 요청에 답변해주세요.
반드시 답변의 끝마다 냥체를 붙여서 답변해주세요

사용자 요청: {message}
검색된 레시피 정보: {context}

다음 형식으로 답변해주세요:

## 🍽️ 추천 키토 레시피
위에서 검색된 레시피들을 바탕으로 키토 식단에 적합한 레시피를 추천드립니다.

### 💡 키토 팁
- 탄수화물 함량을 확인하세요
- 충분한 지방 섭취를 유지하세요
- 개인 취향에 맞게 조절하세요

더 자세한 정보가 필요하시면 언제든 말씀해주세요!
"""

RECIPE_RESPONSE_GENERATION_PROMPT = create_standard_prompt(_base_recipe_prompt)
```

## 🚨 주의사항

### ❌ 하지 말아야 할 것들

1. **공통 규칙을 수동으로 추가하지 마세요**
```python
# ❌ 잘못된 예
_base_prompt = """
질문: {message}

마크다운 포맷팅 규칙:  # 이건 자동으로 추가됨
- 번호 목록 사용 시: "1. 제목:"
"""
```

2. **기존 프롬프트를 그대로 복사하지 마세요**
```python
# ❌ 잘못된 예
OLD_PROMPT = "기존 프롬프트 내용..."
NEW_PROMPT = create_standard_prompt(OLD_PROMPT)  # 중복 규칙 포함됨
```

3. **import를 빼먹지 마세요**
```python
# ❌ 잘못된 예
_base_prompt = "프롬프트 내용..."
PROMPT = create_standard_prompt(_base_prompt)  # import 없음
```

### ✅ 올바른 방법

1. **공통 요소는 제거하고 고유 요소만 남기세요**
2. **반드시 import를 추가하세요**
3. **변수명을 `_base_prompt`로 통일하세요**

## 🧪 테스트 방법

### 1. 프롬프트 생성 테스트
```python
# 프롬프트가 올바르게 생성되는지 확인
prompt = create_standard_prompt(_base_prompt)
print(prompt)
```

### 2. 포맷팅 테스트
```python
# 실제 데이터로 테스트
test_data = {
    "message": "키토 식단 추천해줘",
    "profile_context": "초보자"
}

formatted_prompt = PROMPT.format(**test_data)
print(formatted_prompt)
```

### 3. 공통 규칙 포함 확인
```python
# 마크다운 규칙이 포함되었는지 확인
assert "마크다운 포맷팅 규칙" in PROMPT
assert "1. 제목:" in PROMPT
assert "친근하고 격려하는 톤" in PROMPT
```

## 📊 마이그레이션 전후 비교

| 항목 | Before | After |
|------|--------|-------|
| 코드 라인 수 | ~50줄 | ~15줄 |
| 중복 코드 | 많음 | 없음 |
| 유지보수성 | 어려움 | 쉬움 |
| 일관성 | 불일치 가능 | 보장됨 |
| 가독성 | 복잡함 | 간단함 |

## 🎉 마이그레이션 완료 후

1. **기존 프롬프트 파일 삭제** (백업 후)
2. **새 프롬프트 파일 테스트**
3. **팀원들에게 공유**
4. **문서 업데이트**

## 🆘 문제 해결

### Q: 마이그레이션 후 프롬프트가 작동하지 않아요
A: import 구문을 확인하고, `_base_prompt` 변수명을 사용했는지 확인하세요.

### Q: 공통 규칙이 적용되지 않았어요
A: `create_standard_prompt()` 함수를 사용했는지 확인하세요.

### Q: 기존 프롬프트와 결과가 달라요
A: 공통 요소를 제거할 때 실수로 고유 요소까지 제거했을 수 있습니다. 다시 확인해보세요.

**Happy Migration! 🚀**
