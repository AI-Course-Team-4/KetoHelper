"""
일반 질문 템플릿
"""

# 로그인 사용자용 인사 템플릿
GREETING_TEMPLATE_LOGGED_IN = """
# 👋 안녕하세요!

키토 다이어트 전문 AI 코치입니다! 

## 🥑 제가 도와드릴 수 있는 것들
- **맞춤형 식단표**: "7일 식단표 만들어줘" (알레르기/비선호 식품 반영)
- **개인화 레시피**: "닭가슴살 레시피 알려줘" (프로필 기반 추천)
- **식당 검색**: "강남역 근처 키토 식당 찾아줘"
- **키토 정보**: 키토 다이어트에 대한 모든 질문

## ⚙️ 프로필 설정으로 더 나은 서비스 받기
**프로필을 설정하시면** 더욱 정확한 맞춤형 추천을 받을 수 있습니다:
- **알레르기 정보**: 안전한 식품만 추천
- **비선호 식품**: 싫어하는 음식 제외
- **목표 설정**: 칼로리, 탄수화물 목표에 맞는 계획

## 💡 빠른 시작
**키토 다이어트 시작하려고 해**라고 말씀해주시면 개인 맞춤형 가이드를 제공해드릴게요!

무엇을 도와드릴까요? 😊
"""

# 비로그인 사용자용 인사 템플릿
GREETING_TEMPLATE_GUEST = """
# 👋 안녕하세요!

키토 다이어트 전문 AI 코치입니다! 

## 🥑 제가 도와드릴 수 있는 것들
- **기본 식단표**: "7일 식단표 만들어줘"
- **일반 레시피**: "닭가슴살 레시피 알려줘"
- **식당 검색**: "강남역 근처 키토 식당 찾아줘"
- **키토 정보**: 키토 다이어트에 대한 모든 질문

## 💡 더 나은 서비스를 위해
**로그인**하시면 알레르기, 비선호 식품을 고려한 **맞춤형 추천**을 받을 수 있습니다!

무엇을 도와드릴까요? 😊
"""

# 로그인 사용자용 자기소개 템플릿
INTRODUCTION_TEMPLATE_LOGGED_IN = """
# 🤖 키토 코치 AI

저는 **키토 다이어트 전문 AI 코치**입니다!

## 🎯 주요 기능
- **맞춤형 식단표**: 개인 프로필에 맞는 7일 식단 계획
- **개인화 레시피**: 알레르기/비선호 식품을 고려한 키토 레시피
- **식당 검색**: 위치 기반 키토 친화적 식당 추천
- **캘린더 연동**: 생성된 식단을 캘린더에 자동 저장

## ⚙️ 프로필 설정으로 더 나은 서비스 받기
**프로필을 설정하시면** 더욱 정확한 맞춤형 추천을 받을 수 있습니다:
- **알레르기 정보**: 안전한 식품만 추천
- **비선호 식품**: 싫어하는 음식 제외
- **목표 설정**: 칼로리, 탄수화물 목표에 맞는 계획

## 🥑 키토 다이어트란?
- **고지방, 저탄수화물** 식단
- **탄수화물 20g 이하**로 제한
- **지방 70-80%**, **단백질 20-25%** 비율
- **체중 감량**과 **집중력 향상** 효과

## 💪 시작해보세요!
**키토 다이어트 시작하려고 해**라고 말씀해주시면 개인 맞춤 가이드를 제공해드릴게요!
"""

# 비로그인 사용자용 자기소개 템플릿
INTRODUCTION_TEMPLATE_GUEST = """
# 🤖 키토 코치 AI

저는 **키토 다이어트 전문 AI 코치**입니다!

## 🎯 주요 기능
- **기본 식단표**: 7일 식단 계획 생성
- **일반 레시피**: 키토 레시피 추천
- **식당 검색**: 위치 기반 키토 친화적 식당 추천
- **캘린더 연동**: 생성된 식단을 캘린더에 자동 저장

## 🥑 키토 다이어트란?
- **고지방, 저탄수화물** 식단
- **탄수화물 20g 이하**로 제한
- **지방 70-80%**, **단백질 20-25%** 비율
- **체중 감량**과 **집중력 향상** 효과

## 💡 더 나은 서비스를 위해
**로그인**하시면 알레르기, 비선호 식품을 고려한 **맞춤형 추천**을 받을 수 있습니다!

## 💪 시작해보세요!
"키토 다이어트 시작하려고 해"라고 말씀해주시면 기본 가이드를 제공해드릴게요!
"""

# 로그인 사용자용 키토 설명 템플릿
KETO_EXPLANATION_TEMPLATE_LOGGED_IN = """
# 🥑 키토 다이어트란?

**키토제닉 다이어트** (Ketogenic Diet)는 고지방, 저탄수화물 식단입니다.

## 📊 기본 원리
- **탄수화물**: 20g 이하 (일일 칼로리의 5%)
- **지방**: 70-80% (주 에너지원)
- **단백질**: 20-25% (근육 보호)

## ⚡ 작동 원리
1. **탄수화물 제한** → 글리코겐 고갈
2. **케톤체 생성** → 지방을 에너지로 전환
3. **체중 감량** + **집중력 향상**

## 🍽️ 주요 식품
### ✅ 권장 식품
- **고기**: 소고기, 돼지고기, 닭고기, 오리고기
- **생선**: 연어, 고등어, 참치, 새우
- **지방**: 버터, 올리브오일, 아보카도, 견과류
- **채소**: 잎채소, 브로콜리, 아스파라거스

### ❌ 피해야 할 식품
- **곡물**: 쌀, 밀, 옥수수
- **과일**: 사과, 바나나, 포도 (고당도)
- **당류**: 설탕, 꿀, 시럽
- **가공식품**: 빵, 케이크, 과자

## 🎯 효과
- **체중 감량**: 지방 연소 촉진
- **집중력**: 안정적인 에너지 공급
- **혈당 안정**: 인슐린 저항성 개선

## ⚠️ 주의사항
- **의료진 상담** 필수
- **전해질 보충** 필요
- **점진적 시작** 권장

## ⚙️ 프로필 설정으로 더 나은 서비스 받기
**프로필을 설정하시면** 더욱 정확한 맞춤형 추천을 받을 수 있습니다:
- **알레르기 정보**: 안전한 식품만 추천
- **비선호 식품**: 싫어하는 음식 제외
- **목표 설정**: 칼로리, 탄수화물 목표에 맞는 계획

## 🚀 시작하기
**키토 다이어트 시작하려고 해**라고 말씀해주시면 개인 맞춤 가이드를 제공해드릴게요!
"""

# 비로그인 사용자용 키토 설명 템플릿
KETO_EXPLANATION_TEMPLATE_GUEST = """
# 🥑 키토 다이어트란?

**키토제닉 다이어트** (Ketogenic Diet)는 고지방, 저탄수화물 식단입니다.

## 📊 기본 원리
- **탄수화물**: 20g 이하 (일일 칼로리의 5%)
- **지방**: 70-80% (주 에너지원)
- **단백질**: 20-25% (근육 보호)

## ⚡ 작동 원리
1. **탄수화물 제한** → 글리코겐 고갈
2. **케톤체 생성** → 지방을 에너지로 전환
3. **체중 감량** + **집중력 향상**

## 🍽️ 주요 식품
### ✅ 권장 식품
- **고기**: 소고기, 돼지고기, 닭고기, 오리고기
- **생선**: 연어, 고등어, 참치, 새우
- **지방**: 버터, 올리브오일, 아보카도, 견과류
- **채소**: 잎채소, 브로콜리, 아스파라거스

### ❌ 피해야 할 식품
- **곡물**: 쌀, 밀, 옥수수
- **과일**: 사과, 바나나, 포도 (고당도)
- **당류**: 설탕, 꿀, 시럽
- **가공식품**: 빵, 케이크, 과자

## 🎯 효과
- **체중 감량**: 지방 연소 촉진
- **집중력**: 안정적인 에너지 공급
- **혈당 안정**: 인슐린 저항성 개선

## ⚠️ 주의사항
- **의료진 상담** 필수
- **전해질 보충** 필요
- **점진적 시작** 권장

## 💡 더 나은 서비스를 위해
**로그인**하시면 **프로필 정보**를 입력해 알레르기, 비선호 식품을 고려한 **맞춤형 가이드**를 받을 수 있습니다!

## 🚀 시작하기
**키토 다이어트 시작하려고 해**라고 말씀해주시면 기본 가이드를 제공해드릴게요!
"""

def is_logged_in_user(profile: dict) -> bool:
    """로그인 사용자 여부 확인"""
    return bool(profile.get("user_id"))

def get_general_response_template(message: str, profile: dict = None) -> str:
    """일반 질문에 대한 템플릿 응답 (사용자 상태별)"""
    
    message_lower = message.lower().strip()
    is_logged_in = is_logged_in_user(profile or {})
    
    # 키토 시작 가이드 관련 (정확한 시작 의도만 감지)
    keto_start_keywords = [
        "키토 다이어트 시작하려고 해",
        "키토 다이어트 시작하려고",
        "키토 다이어트 시작",
        "키토 시작하려고 해",
        "키토 시작하려고",
        "키토 시작",
        "다이어트 시작하려고 해",
        "다이어트 시작하려고",
        "다이어트 시작"
    ]
    if any(keyword in message_lower for keyword in keto_start_keywords):
        # 키토 시작 가이드 템플릿 import 및 사용
        from .keto_start_template import format_keto_start_guide
        return format_keto_start_guide(profile or {})
    
    # 인사 관련
    greeting_keywords = ["안녕", "안녕하세요", "하이", "hi", "hello"]
    if any(keyword in message_lower for keyword in greeting_keywords):
        return GREETING_TEMPLATE_LOGGED_IN if is_logged_in else GREETING_TEMPLATE_GUEST
    
    # 자기소개만 템플릿으로 처리 (정확한 매칭)
    intro_exact_keywords = ["너는 뭐야", "당신은 뭐야", "너는 누구야", "당신은 누구야", "너 뭐야", "당신 뭐야", "너 누구야", "당신 누구야"]
    if any(keyword == message_lower for keyword in intro_exact_keywords):
        return INTRODUCTION_TEMPLATE_LOGGED_IN if is_logged_in else INTRODUCTION_TEMPLATE_GUEST
    
    # 템플릿 미매칭 시 None 반환 (LLM이 처리하도록)
    return None
