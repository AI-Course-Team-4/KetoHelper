"""
의도 분류 프롬프트
사용자 메시지를 분석하여 의도를 분류
"""

INTENT_CLASSIFICATION_PROMPT = """
사용자 메시지를 분석하여 의도를 분류하세요.

사용자 메시지: "{message}"

다음 JSON 형태로 **정확히** 응답하세요:
{{
    "intent": "meal_plan",
    "confidence": 0.9,
    "reasoning": "분류 이유"
}}

**중요**: intent 값은 반드시 다음 중 하나여야 합니다:
- "recipe_search" (개별 레시피 검색/생성)
- "meal_plan" (식단표/식단 계획 생성)
- "place_search" (식당 검색)
- "calendar_save" (캘린더 저장)
- "general" (일반 대화)

**각 의도의 실제 처리 방식:**

1. **recipe_search** - 개별 레시피 처리:
   - 하이브리드 검색으로 기존 레시피 찾기
   - 검색 결과 없으면 AI로 새 레시피 생성
   - 개인 프로필(알레르기, 불호식품) 반영
   예: "불고기 레시피", "계란말이 만드는 법", "키토 아침 레시피", "저탄수 디저트"

2. **meal_plan** - 식단표 생성:
   - MealPlannerAgent로 구조화된 식단표 생성
   - 일수별 아침/점심/저녁/간식 계획
   - 개인 프로필 기반 맞춤형 식단
   예: "7일 식단표", "일주일 식단", "이번 주 메뉴 계획", "3일 키토 식단표"

3. **place_search** - 식당 검색:
   - PlaceSearchAgent로 위치 기반 식당 검색
   - 키토 친화적 메뉴 추천
   - 거리/카테고리 필터링
   예: "강남역 근처 식당", "키토 식당 찾아줘", "배달 가능한 곳", "맛집 추천"

4. **calendar_save** - 캘린더 저장:
   - 생성된 식단을 캘린더에 일정으로 저장
   - 충돌 검사 및 해결
   - 타이틀/메모 커스터마이징
   예: "캘린더에 저장", "일정 등록", "재등록", "타이틀 바꿔서 저장"

5. **general** - 일반 대화:
   - 키토 다이어트 관련 질문 답변
   - 프로필 설정 (알레르기, 불호식품 등)
   - 인사 및 일반 대화
   예: "키토 다이어트가 뭐야?", "안녕", "브로콜리 싫어해", "고마워"

**핵심 판단 기준:**
1. **식단표 vs 레시피**: "식단표", "일주일", "메뉴 계획" → meal_plan
2. **개별 요리**: "레시피", "만드는 법", "어떻게 만들" → recipe_search  
3. **장소 검색**: "식당", "근처", "찾아줘", "추천" → place_search
4. **저장 요청**: "저장", "등록", "캘린더" → calendar_save
5. **일반 질문**: "뭐야?", "어떻게?", 인사 → general

**중요**: 
- 구체적인 요청이 있으면 해당 의도로 분류
- 애매한 경우 더 구체적인 처리 방식을 고려하여 분류
- 문맥을 정확히 파악하여 분류하세요.
"""

def get_intent_prompt(message: str) -> str:
    """
    의도 분류 프롬프트 반환
    
    Args:
        message: 사용자 메시지
    
    Returns:
        완성된 프롬프트 문자열
    """
    return INTENT_CLASSIFICATION_PROMPT.format(message=message)
