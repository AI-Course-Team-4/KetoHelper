"""
ì˜ë„ ë¶„ë¥˜ í”„ë¡¬í”„íŠ¸
ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ë¶„ì„í•˜ì—¬ ì˜ë„ì™€ ìŠ¬ë¡¯ì„ ì¶”ì¶œ
í•˜ì´ë¸Œë¦¬ë“œ ë°©ì‹ ì§€ì›: í‚¤ì›Œë“œ ë¶„ì„ íŒíŠ¸ í™œìš© ê°€ëŠ¥
"""

INTENT_CLASSIFICATION_PROMPT = """
ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ë¶„ì„í•˜ì—¬ ì˜ë„ì™€ ìŠ¬ë¡¯ì„ ì¶”ì¶œí•˜ì„¸ìš”.

ì‚¬ìš©ì ë©”ì‹œì§€: "{message}"

{keyword_hint_section}

ë‹¤ìŒ JSON í˜•íƒœë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{{
    "intent": "meal_planning|restaurant_search|calendar_save|general",
    "slots": {{
        "location": "ì§€ì—­ëª… (ì˜ˆ: ì—­ì‚¼ì—­, ê°•ë‚¨)",
        "radius": "ê²€ìƒ‰ ë°˜ê²½ (km)",
        "category": "ìŒì‹ ì¹´í…Œê³ ë¦¬",
        "preferences": "ì„ í˜¸ì‚¬í•­",
        "allergies": "ì•Œë ˆë¥´ê¸°",
        "meal_type": "ì‹ì‚¬ íƒ€ì… (ì•„ì¹¨/ì ì‹¬/ì €ë…)",
        "days": "ì‹ë‹¨í‘œ ì¼ìˆ˜ (í•˜ë£¨ì¹˜/1ì¼=1, ì¼ì£¼ì¼=7, 3ì¼=3 ë“±)"
    }}
}}

ì˜ë„ ë¶„ë¥˜ ê¸°ì¤€ (ì¤‘ìš”!):
- meal_planning: ì‹ë‹¨ ê³„íš, ë ˆì‹œí”¼, ìš”ë¦¬ë²• ê´€ë ¨ ëª¨ë“  ìš”ì²­ (ê¸°ì¡´ recipe + mealplan í†µí•©)
  ì˜ˆ: "ë¶ˆê³ ê¸° ë ˆì‹œí”¼", "ê³„ë€ë§ì´ ë§Œë“œëŠ” ë²•", "7ì¼ ì‹ë‹¨í‘œ ë§Œë“¤ì–´ì¤˜", "ì´ë²ˆ ì£¼ ë©”ë‰´ ê³„íš", "í‚¤í†  ì‹ë‹¨ ë§Œë“¤ì–´ì¤˜"
  
- restaurant_search: ì‹ë‹¹ì„ "ì°¾ì•„ë‹¬ë¼", "ì¶”ì²œí•´ì¤˜", "ê·¼ì²˜ì— ì–´ë”” ìˆì–´?" ìš”ì²­ (ê¸°ì¡´ place)
  ì˜ˆ: "ê°•ë‚¨ì—­ ê·¼ì²˜ ì‹ë‹¹", "í‚¤í†  ì‹ë‹¹ ì°¾ì•„ì¤˜", "ë°°ë‹¬ ê°€ëŠ¥í•œ ê³³"
  
- calendar_save: ì´ë¯¸ ë§Œë“  ì‹ë‹¨ì„ ìº˜ë¦°ë”ì— ì €ì¥í•˜ëŠ” ìš”ì²­
  ì˜ˆ: "ìº˜ë¦°ë”ì— ì €ì¥í•´ì¤˜", "ì¼ì •ìœ¼ë¡œ ë“±ë¡", "ìº˜ë¦°ë”ì— ì¶”ê°€í•´ì¤˜"
  
ì¤‘ìš”: days ìŠ¬ë¡¯ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ìˆ«ìë¡œ ì…ë ¥í•˜ì„¸ìš”:
- "í•˜ë£¨ì¹˜", "1ì¼", "í•˜ë£¨", "ì˜¤ëŠ˜" â†’ days: 1
- "ì´í‹€", "2ì¼" â†’ days: 2  
- "3ì¼", "ì‚¬í˜" â†’ days: 3
- "ì¼ì£¼ì¼", "7ì¼", "í•œ ì£¼", "ì´ë²ˆì£¼", "ë‹¤ìŒì£¼" â†’ days: 7
  
- general: ì¼ë°˜ ëŒ€í™”, ì¸ì‚¬, ê¸°ì–µ ìš”ì²­, ë„ì›€ë§ ë“± (ê¸°ì¡´ memory + other í†µí•©)
  ì˜ˆ: "ì•ˆë…•í•˜ì„¸ìš”", "ê³ ë§ˆì›Œ", "ë¸Œë¡œì½œë¦¬ ì‹«ì–´í•´", "ì•Œë ˆë¥´ê¸° ìˆì–´", "í‚¤í†  ì‹ë‹¨ì´ ë­ì•¼?", "ë„ì›€ë§"
  
ì£¼ì˜ì‚¬í•­:
- "ì‹ë‹¨"ì´ë¼ëŠ” ë‹¨ì–´ê°€ ìˆì–´ë„ êµ¬ì²´ì ì¸ ê³„íš ìš”ì²­ì´ ì•„ë‹ˆë©´ generalë¡œ ë¶„ë¥˜
- ì§ˆë¬¸í˜• ë¬¸ì¥ì€ ëŒ€ë¶€ë¶„ generalë¡œ ë¶„ë¥˜
- ì˜ë¬¸ì‚¬(ë­, ì™œ, ì–´ë–»ê²Œ, ì–¸ì œ, ì–´ë””ì„œ)ê°€ ìˆìœ¼ë©´ general ìš°ì„  ê³ ë ¤
"""

# í‚¤ì›Œë“œ íŒíŠ¸ê°€ ìˆì„ ë•Œ ì‚¬ìš©í•˜ëŠ” í–¥ìƒëœ í”„ë¡¬í”„íŠ¸
ENHANCED_INTENT_CLASSIFICATION_PROMPT = """
ì‚¬ìš©ì ë©”ì‹œì§€ë¥¼ ë¶„ì„í•˜ì—¬ ì˜ë„ì™€ ìŠ¬ë¡¯ì„ ì¶”ì¶œí•˜ì„¸ìš”.

ì‚¬ìš©ì ë©”ì‹œì§€: "{message}"

ğŸ” í‚¤ì›Œë“œ ë¶„ì„ ê²°ê³¼: {keyword_intent} (í™•ì‹ ë„: {confidence:.2f})
ğŸ’¡ ì°¸ê³ ì‚¬í•­: ìœ„ í‚¤ì›Œë“œ ë¶„ì„ ê²°ê³¼ë¥¼ ì°¸ê³ í•˜ë˜, ë§¥ë½ì„ ê³ ë ¤í•˜ì—¬ ë” ì •í™•í•œ ë¶„ì„ì„ í•´ì£¼ì„¸ìš”.

ë‹¤ìŒ JSON í˜•íƒœë¡œ ì‘ë‹µí•˜ì„¸ìš”:
{{
    "intent": "meal_planning|restaurant_search|calendar_save|general",
    "slots": {{
        "location": "ì§€ì—­ëª… (ì˜ˆ: ì—­ì‚¼ì—­, ê°•ë‚¨)",
        "radius": "ê²€ìƒ‰ ë°˜ê²½ (km)",
        "category": "ìŒì‹ ì¹´í…Œê³ ë¦¬",
        "preferences": "ì„ í˜¸ì‚¬í•­",
        "allergies": "ì•Œë ˆë¥´ê¸°",
        "meal_type": "ì‹ì‚¬ íƒ€ì… (ì•„ì¹¨/ì ì‹¬/ì €ë…)",
        "days": "ì‹ë‹¨í‘œ ì¼ìˆ˜ (í•˜ë£¨ì¹˜/1ì¼=1, ì¼ì£¼ì¼=7, 3ì¼=3 ë“±)"
    }}
}}

ì˜ë„ ë¶„ë¥˜ ê¸°ì¤€ (ì¤‘ìš”!):
- meal_planning: ì‹ë‹¨ ê³„íš, ë ˆì‹œí”¼, ìš”ë¦¬ë²• ê´€ë ¨ ëª¨ë“  ìš”ì²­ (ê¸°ì¡´ recipe + mealplan í†µí•©)
  ì˜ˆ: "ë¶ˆê³ ê¸° ë ˆì‹œí”¼", "ê³„ë€ë§ì´ ë§Œë“œëŠ” ë²•", "7ì¼ ì‹ë‹¨í‘œ ë§Œë“¤ì–´ì¤˜", "ì´ë²ˆ ì£¼ ë©”ë‰´ ê³„íš", "í‚¤í†  ì‹ë‹¨ ë§Œë“¤ì–´ì¤˜"
  
- restaurant_search: ì‹ë‹¹ì„ "ì°¾ì•„ë‹¬ë¼", "ì¶”ì²œí•´ì¤˜", "ê·¼ì²˜ì— ì–´ë”” ìˆì–´?" ìš”ì²­ (ê¸°ì¡´ place)
  ì˜ˆ: "ê°•ë‚¨ì—­ ê·¼ì²˜ ì‹ë‹¹", "í‚¤í†  ì‹ë‹¹ ì°¾ì•„ì¤˜", "ë°°ë‹¬ ê°€ëŠ¥í•œ ê³³"
  
- calendar_save: ì´ë¯¸ ë§Œë“  ì‹ë‹¨ì„ ìº˜ë¦°ë”ì— ì €ì¥í•˜ëŠ” ìš”ì²­
  ì˜ˆ: "ìº˜ë¦°ë”ì— ì €ì¥í•´ì¤˜", "ì¼ì •ìœ¼ë¡œ ë“±ë¡", "ìº˜ë¦°ë”ì— ì¶”ê°€í•´ì¤˜"
  
ì¤‘ìš”: days ìŠ¬ë¡¯ì—ëŠ” ë‹¤ìŒê³¼ ê°™ì´ ìˆ«ìë¡œ ì…ë ¥í•˜ì„¸ìš”:
- "í•˜ë£¨ì¹˜", "1ì¼", "í•˜ë£¨", "ì˜¤ëŠ˜" â†’ days: 1
- "ì´í‹€", "2ì¼" â†’ days: 2  
- "3ì¼", "ì‚¬í˜" â†’ days: 3
- "ì¼ì£¼ì¼", "7ì¼", "í•œ ì£¼", "ì´ë²ˆì£¼", "ë‹¤ìŒì£¼" â†’ days: 7
  
- general: ì¼ë°˜ ëŒ€í™”, ì¸ì‚¬, ê¸°ì–µ ìš”ì²­, ë„ì›€ë§ ë“± (ê¸°ì¡´ memory + other í†µí•©)
  ì˜ˆ: "ì•ˆë…•í•˜ì„¸ìš”", "ê³ ë§ˆì›Œ", "ë¸Œë¡œì½œë¦¬ ì‹«ì–´í•´", "ì•Œë ˆë¥´ê¸° ìˆì–´", "í‚¤í†  ì‹ë‹¨ì´ ë­ì•¼?", "ë„ì›€ë§"

ğŸ¯ í‚¤ì›Œë“œ ë¶„ì„ í™œìš© ê°€ì´ë“œ:
- í‚¤ì›Œë“œ ë¶„ì„ì´ ë†’ì€ í™•ì‹ ë„(0.8+)ë¥¼ ë³´ì¸ë‹¤ë©´ í•´ë‹¹ ê²°ê³¼ë¥¼ ìš°ì„  ê³ ë ¤í•˜ì„¸ìš”
- í‚¤ì›Œë“œ ë¶„ì„ì´ ë‚®ì€ í™•ì‹ ë„ë¥¼ ë³´ì¸ë‹¤ë©´ ë§¥ë½ê³¼ ë¬¸ì¥ êµ¬ì¡°ë¥¼ ë” ì¤‘ìš”í•˜ê²Œ ê³ ë ¤í•˜ì„¸ìš”
- ì§ˆë¬¸í˜• íŒ¨í„´ì´ ê°•í•˜ë‹¤ë©´ í‚¤ì›Œë“œì™€ ê´€ê³„ì—†ì´ 'general' ê³ ë ¤í•˜ì„¸ìš”
- êµ¬ì²´ì ì¸ í–‰ë™ ìš”ì²­(ë§Œë“¤ì–´ì¤˜, ì°¾ì•„ì¤˜, ìƒì„±í•´ì¤˜)ì´ ìˆë‹¤ë©´ í•´ë‹¹ ì˜ë„ë¡œ ë¶„ë¥˜í•˜ì„¸ìš”

ì£¼ì˜ì‚¬í•­:
- "ì‹ë‹¨"ì´ë¼ëŠ” ë‹¨ì–´ê°€ ìˆì–´ë„ êµ¬ì²´ì ì¸ ê³„íš ìš”ì²­ì´ ì•„ë‹ˆë©´ generalë¡œ ë¶„ë¥˜
- ì§ˆë¬¸í˜• ë¬¸ì¥ì€ ëŒ€ë¶€ë¶„ generalë¡œ ë¶„ë¥˜
- ì˜ë¬¸ì‚¬(ë­, ì™œ, ì–´ë–»ê²Œ, ì–¸ì œ, ì–´ë””ì„œ)ê°€ ìˆìœ¼ë©´ general ìš°ì„  ê³ ë ¤
"""

def create_keyword_hint_section(keyword_intent: str = None, confidence: float = None) -> str:
    """í‚¤ì›Œë“œ íŒíŠ¸ ì„¹ì…˜ ìƒì„±"""
    if keyword_intent and confidence is not None:
        return f"""
ğŸ” í‚¤ì›Œë“œ ë¶„ì„ ê²°ê³¼: {keyword_intent} (í™•ì‹ ë„: {confidence:.2f})
ğŸ’¡ ì°¸ê³ ì‚¬í•­: ìœ„ í‚¤ì›Œë“œ ë¶„ì„ ê²°ê³¼ë¥¼ ì°¸ê³ í•˜ë˜, ë§¥ë½ì„ ê³ ë ¤í•˜ì—¬ ë” ì •í™•í•œ ë¶„ì„ì„ í•´ì£¼ì„¸ìš”.
        """.strip()
    else:
        return ""

def get_intent_prompt(message: str, keyword_intent: str = None, confidence: float = None) -> str:
    """
    ì ì ˆí•œ ì˜ë„ ë¶„ë¥˜ í”„ë¡¬í”„íŠ¸ ë°˜í™˜
    
    Args:
        message: ì‚¬ìš©ì ë©”ì‹œì§€
        keyword_intent: í‚¤ì›Œë“œ ë¶„ì„ ê²°ê³¼ (ì„ íƒì‚¬í•­)
        confidence: í‚¤ì›Œë“œ ë¶„ì„ í™•ì‹ ë„ (ì„ íƒì‚¬í•­)
    
    Returns:
        ì™„ì„±ëœ í”„ë¡¬í”„íŠ¸ ë¬¸ìì—´
    """
    if keyword_intent and confidence is not None:
        # í‚¤ì›Œë“œ íŒíŠ¸ê°€ ìˆì„ ë•Œ í–¥ìƒëœ í”„ë¡¬í”„íŠ¸ ì‚¬ìš©
        return ENHANCED_INTENT_CLASSIFICATION_PROMPT.format(
            message=message,
            keyword_intent=keyword_intent,
            confidence=confidence
        )
    else:
        # ê¸°ë³¸ í”„ë¡¬í”„íŠ¸ ì‚¬ìš©
        keyword_hint_section = create_keyword_hint_section()
        return INTENT_CLASSIFICATION_PROMPT.format(
            message=message,
            keyword_hint_section=keyword_hint_section
        )
