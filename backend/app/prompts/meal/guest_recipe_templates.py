"""
ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ììš© ë ˆì‹œí”¼ í…œí”Œë¦¿
ê°œì¸í™” ì—†ì´ ê¸°ë³¸ì ì¸ í‚¤í†  ë ˆì‹œí”¼ ì œê³µ
"""

from typing import Dict, Any, Optional

# ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ììš© ë ˆì‹œí”¼ í…œí”Œë¦¿
GUEST_RECIPE_TEMPLATES = {
    "ë‹­ê°€ìŠ´ì‚´": {
        "title": "í‚¤í†  ë‹­ê°€ìŠ´ì‚´ ìŠ¤í…Œì´í¬",
        "ingredients": [
            "ë‹­ê°€ìŠ´ì‚´ 200g",
            "ì˜¬ë¦¬ë¸Œì˜¤ì¼ 2í°ìˆ ",
            "ì†Œê¸ˆ, í›„ì¶” ì ë‹¹ëŸ‰",
            "ë§ˆëŠ˜ 2ìª½",
            "ë¡œì¦ˆë§ˆë¦¬ 1ì¤„ê¸°"
        ],
        "steps": [
            "ë‹­ê°€ìŠ´ì‚´ì„ ì†Œê¸ˆ, í›„ì¶”ë¡œ ê°„ì„ ë§ì¶¥ë‹ˆë‹¤",
            "íŒ¬ì— ì˜¬ë¦¬ë¸Œì˜¤ì¼ì„ ë‘ë¥´ê³  ë§ˆëŠ˜ê³¼ ë¡œì¦ˆë§ˆë¦¬ë¥¼ ë„£ì–´ í–¥ì„ ëƒ…ë‹ˆë‹¤",
            "ë‹­ê°€ìŠ´ì‚´ì„ ë„£ê³  ì•ë’¤ë¡œ 4-5ë¶„ì”© êµ¬ì›Œì¤ë‹ˆë‹¤",
            "ì™„ì„±ë˜ë©´ 5ë¶„ê°„ íœ´ì‹ì‹œí‚¨ í›„ ë¨¹ìŠµë‹ˆë‹¤"
        ],
        "nutrition": {
            "calories": 250,
            "carbs": 2,
            "protein": 45,
            "fat": 8
        },
        "tips": [
            "ë‹­ê°€ìŠ´ì‚´ì„ ì–‡ê²Œ ì°ì–´ì„œ êµ¬ìš°ë©´ ë” ë¶€ë“œëŸ¬ì›Œì§‘ë‹ˆë‹¤",
            "êµ¬ìš´ í›„ 5ë¶„ê°„ íœ´ì‹ì‹œí‚¤ë©´ ìœ¡ì¦™ì´ ê³ ë¥´ê²Œ ë¶„í¬ë©ë‹ˆë‹¤"
        ]
    },
    "ê³„ë€": {
        "title": "í‚¤í†  ê³„ë€ë§ì´",
        "ingredients": [
            "ê³„ë€ 3ê°œ",
            "ë²„í„° 1í°ìˆ ",
            "ì†Œê¸ˆ, í›„ì¶” ì ë‹¹ëŸ‰",
            "íŒŒìŠ¬ë¦¬ ì ë‹¹ëŸ‰"
        ],
        "steps": [
            "ê³„ë€ì„ í’€ì–´ì„œ ì†Œê¸ˆ, í›„ì¶”ë¡œ ê°„ì„ ë§ì¶¥ë‹ˆë‹¤",
            "íŒ¬ì— ë²„í„°ë¥¼ ë…¹ì´ê³  ê³„ë€ë¬¼ì„ ë¶€ì–´ì¤ë‹ˆë‹¤",
            "ì•½í•œ ë¶ˆì—ì„œ ì “ê°€ë½ìœ¼ë¡œ ì €ìœ¼ë©´ì„œ ìµí˜€ì¤ë‹ˆë‹¤",
            "ì™„ì„±ë˜ë©´ íŒŒìŠ¬ë¦¬ë¥¼ ë¿Œë ¤ì¤ë‹ˆë‹¤"
        ],
        "nutrition": {
            "calories": 180,
            "carbs": 1,
            "protein": 15,
            "fat": 12
        },
        "tips": [
            "ì•½í•œ ë¶ˆì—ì„œ ì²œì²œíˆ ìµíˆë©´ ë¶€ë“œëŸ¬ìš´ ê³„ë€ë§ì´ê°€ ë©ë‹ˆë‹¤",
            "ë²„í„° ëŒ€ì‹  ì½”ì½”ë„›ì˜¤ì¼ì„ ì‚¬ìš©í•´ë„ ì¢‹ìŠµë‹ˆë‹¤"
        ]
    },
    "ì—°ì–´": {
        "title": "í‚¤í†  ì—°ì–´ ìŠ¤í…Œì´í¬",
        "ingredients": [
            "ì—°ì–´ 200g",
            "ì˜¬ë¦¬ë¸Œì˜¤ì¼ 2í°ìˆ ",
            "ì†Œê¸ˆ, í›„ì¶” ì ë‹¹ëŸ‰",
            "ë ˆëª¬ 1/2ê°œ",
            "ë”œ ì ë‹¹ëŸ‰"
        ],
        "steps": [
            "ì—°ì–´ë¥¼ ì†Œê¸ˆ, í›„ì¶”ë¡œ ê°„ì„ ë§ì¶¥ë‹ˆë‹¤",
            "íŒ¬ì— ì˜¬ë¦¬ë¸Œì˜¤ì¼ì„ ë‘ë¥´ê³  ì—°ì–´ë¥¼ ë„£ì–´ì¤ë‹ˆë‹¤",
            "ì•ë’¤ë¡œ 3-4ë¶„ì”© êµ¬ì›Œì¤ë‹ˆë‹¤",
            "ì™„ì„±ë˜ë©´ ë ˆëª¬ì¦™ê³¼ ë”œì„ ë¿Œë ¤ì¤ë‹ˆë‹¤"
        ],
        "nutrition": {
            "calories": 280,
            "carbs": 1,
            "protein": 35,
            "fat": 15
        },
        "tips": [
            "ì—°ì–´ëŠ” ë„ˆë¬´ ì˜¤ë˜ êµ¬ìš°ë©´ ê±´ì¡°í•´ì§€ë¯€ë¡œ ì£¼ì˜í•˜ì„¸ìš”",
            "ë ˆëª¬ì¦™ì„ ë¿Œë¦¬ë©´ ë¹„ë¦° ë§›ì„ ì¤„ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤"
        ]
    },
    "ì•„ë³´ì¹´ë„": {
        "title": "í‚¤í†  ì•„ë³´ì¹´ë„ ìƒëŸ¬ë“œ",
        "ingredients": [
            "ì•„ë³´ì¹´ë„ 1ê°œ",
            "í† ë§ˆí†  1ê°œ",
            "ì–‘íŒŒ 1/4ê°œ",
            "ì˜¬ë¦¬ë¸Œì˜¤ì¼ 2í°ìˆ ",
            "ë ˆëª¬ì¦™ 1í°ìˆ ",
            "ì†Œê¸ˆ, í›„ì¶” ì ë‹¹ëŸ‰"
        ],
        "steps": [
            "ì•„ë³´ì¹´ë„ë¥¼ ì ë‹¹í•œ í¬ê¸°ë¡œ ì°ì–´ì¤ë‹ˆë‹¤",
            "í† ë§ˆí† ì™€ ì–‘íŒŒë„ ì°ì–´ì¤ë‹ˆë‹¤",
            "ì˜¬ë¦¬ë¸Œì˜¤ì¼, ë ˆëª¬ì¦™, ì†Œê¸ˆ, í›„ì¶”ë¡œ ë“œë ˆì‹±ì„ ë§Œë“­ë‹ˆë‹¤",
            "ëª¨ë“  ì¬ë£Œë¥¼ ì„ì–´ì„œ ì™„ì„±í•©ë‹ˆë‹¤"
        ],
        "nutrition": {
            "calories": 220,
            "carbs": 8,
            "protein": 3,
            "fat": 20
        },
        "tips": [
            "ì•„ë³´ì¹´ë„ëŠ” ë„ˆë¬´ ìµìœ¼ë©´ ìƒëŸ¬ë“œê°€ ë¬¼ì»¹í•´ì§‘ë‹ˆë‹¤",
            "ë ˆëª¬ì¦™ì„ ë¿Œë¦¬ë©´ ì•„ë³´ì¹´ë„ê°€ ê°ˆë³€í•˜ëŠ” ê²ƒì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
        ]
    },
    "ì†Œê³ ê¸°": {
        "title": "í‚¤í†  ì†Œê³ ê¸° ìŠ¤í…Œì´í¬",
        "ingredients": [
            "ì†Œê³ ê¸° 200g",
            "ë²„í„° 2í°ìˆ ",
            "ì†Œê¸ˆ, í›„ì¶” ì ë‹¹ëŸ‰",
            "ë§ˆëŠ˜ 2ìª½",
            "ë¡œì¦ˆë§ˆë¦¬ 1ì¤„ê¸°"
        ],
        "steps": [
            "ì†Œê³ ê¸°ë¥¼ ì†Œê¸ˆ, í›„ì¶”ë¡œ ê°„ì„ ë§ì¶¥ë‹ˆë‹¤",
            "íŒ¬ì— ë²„í„°ë¥¼ ë…¹ì´ê³  ë§ˆëŠ˜ê³¼ ë¡œì¦ˆë§ˆë¦¬ë¥¼ ë„£ì–´ í–¥ì„ ëƒ…ë‹ˆë‹¤",
            "ì†Œê³ ê¸°ë¥¼ ë„£ê³  ì•ë’¤ë¡œ 3-4ë¶„ì”© êµ¬ì›Œì¤ë‹ˆë‹¤",
            "ì™„ì„±ë˜ë©´ 5ë¶„ê°„ íœ´ì‹ì‹œí‚¨ í›„ ë¨¹ìŠµë‹ˆë‹¤"
        ],
        "nutrition": {
            "calories": 320,
            "carbs": 1,
            "protein": 40,
            "fat": 18
        },
        "tips": [
            "ì†Œê³ ê¸°ëŠ” ì‹¤ì˜¨ì—ì„œ 30ë¶„ê°„ ë‘ì—ˆë‹¤ê°€ êµ¬ìš°ë©´ ë” ë§›ìˆìŠµë‹ˆë‹¤",
            "êµ¬ìš´ í›„ íœ´ì‹ì‹œí‚¤ë©´ ìœ¡ì¦™ì´ ê³ ë¥´ê²Œ ë¶„í¬ë©ë‹ˆë‹¤"
        ]
    },
    "ìƒˆìš°": {
        "title": "í‚¤í†  ìƒˆìš° ë³¶ìŒ",
        "ingredients": [
            "ìƒˆìš° 200g",
            "ë¸Œë¡œì½œë¦¬ 1ì»µ",
            "ì˜¬ë¦¬ë¸Œì˜¤ì¼ 2í°ìˆ ",
            "ë§ˆëŠ˜ 2ìª½",
            "ì†Œê¸ˆ, í›„ì¶” ì ë‹¹ëŸ‰"
        ],
        "steps": [
            "ìƒˆìš°ë¥¼ ì†Œê¸ˆ, í›„ì¶”ë¡œ ê°„ì„ ë§ì¶¥ë‹ˆë‹¤",
            "íŒ¬ì— ì˜¬ë¦¬ë¸Œì˜¤ì¼ì„ ë‘ë¥´ê³  ë§ˆëŠ˜ì„ ë³¶ìŠµë‹ˆë‹¤",
            "ìƒˆìš°ë¥¼ ë„£ê³  2-3ë¶„ ë³¶ìŠµë‹ˆë‹¤",
            "ë¸Œë¡œì½œë¦¬ë¥¼ ë„£ê³  1-2ë¶„ ë” ë³¶ì•„ ì™„ì„±í•©ë‹ˆë‹¤"
        ],
        "nutrition": {
            "calories": 180,
            "carbs": 4,
            "protein": 25,
            "fat": 8
        },
        "tips": [
            "ìƒˆìš°ëŠ” ë„ˆë¬´ ì˜¤ë˜ ë³¶ìœ¼ë©´ ì§ˆê²¨ì§‘ë‹ˆë‹¤",
            "ë¸Œë¡œì½œë¦¬ëŠ” ë„ˆë¬´ ìµíˆì§€ ì•Šì•„ì•¼ ì•„ì‚­í•œ ì‹ê°ì„ ìœ ì§€í•©ë‹ˆë‹¤"
        ]
    },
    "ì°¸ì¹˜": {
        "title": "í‚¤í†  ì°¸ì¹˜ ìƒëŸ¬ë“œ",
        "ingredients": [
            "ì°¸ì¹˜ìº” 1ê°œ",
            "ì•„ë³´ì¹´ë„ 1ê°œ",
            "ì–‘ìƒì¶” 2ì»µ",
            "ì˜¬ë¦¬ë¸Œì˜¤ì¼ 2í°ìˆ ",
            "ë ˆëª¬ì¦™ 1í°ìˆ ",
            "ì†Œê¸ˆ, í›„ì¶” ì ë‹¹ëŸ‰"
        ],
        "steps": [
            "ì°¸ì¹˜ìº”ì„ ì—´ì–´ ê¸°ë¦„ì„ ì œê±°í•©ë‹ˆë‹¤",
            "ì•„ë³´ì¹´ë„ë¥¼ ì ë‹¹í•œ í¬ê¸°ë¡œ ì°ì–´ì¤ë‹ˆë‹¤",
            "ì–‘ìƒì¶”ë¥¼ ì”»ì–´ ë¬¼ê¸°ë¥¼ ì œê±°í•©ë‹ˆë‹¤",
            "ì˜¬ë¦¬ë¸Œì˜¤ì¼, ë ˆëª¬ì¦™, ì†Œê¸ˆ, í›„ì¶”ë¡œ ë“œë ˆì‹±ì„ ë§Œë“­ë‹ˆë‹¤",
            "ëª¨ë“  ì¬ë£Œë¥¼ ì„ì–´ì„œ ì™„ì„±í•©ë‹ˆë‹¤"
        ],
        "nutrition": {
            "calories": 250,
            "carbs": 6,
            "protein": 20,
            "fat": 18
        },
        "tips": [
            "ì°¸ì¹˜ëŠ” ê¸°ë¦„ì„ ì™„ì „íˆ ì œê±°í•´ì•¼ ìƒëŸ¬ë“œê°€ ê¹”ë”í•©ë‹ˆë‹¤",
            "ì•„ë³´ì¹´ë„ëŠ” ë°”ë¡œ ë¨¹ê¸° ì§ì „ì— ì°ì–´ì•¼ ê°ˆë³€ì„ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤"
        ]
    }
}

def get_guest_recipe_template(ingredient: str) -> Optional[Dict[str, Any]]:
    """ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ììš© ë ˆì‹œí”¼ í…œí”Œë¦¿ ë°˜í™˜"""
    
    # ì¬ë£Œëª… ì •ê·œí™”
    ingredient_lower = ingredient.lower().strip()
    
    # ì§ì ‘ ë§¤ì¹­
    if ingredient_lower in GUEST_RECIPE_TEMPLATES:
        return GUEST_RECIPE_TEMPLATES[ingredient_lower]
    
    # ë¶€ë¶„ ë§¤ì¹­
    for key, template in GUEST_RECIPE_TEMPLATES.items():
        if key in ingredient_lower or ingredient_lower in key:
            return template
    
    return None

def format_guest_recipe_template(template: Dict[str, Any]) -> str:
    """ë¹„ë¡œê·¸ì¸ ì‚¬ìš©ììš© ë ˆì‹œí”¼ í…œí”Œë¦¿ì„ ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…"""
    
    # ë§ˆí¬ë‹¤ìš´ í˜•ì‹ìœ¼ë¡œ í¬ë§·íŒ…
    markdown = f"""# ğŸ½ï¸ {template['title']}

## ğŸ“‹ ì¬ë£Œ (2ì¸ë¶„)
{chr(10).join([f"- {ingredient}" for ingredient in template['ingredients']])}

## ğŸ‘¨â€ğŸ³ ì¡°ë¦¬ë²•
{chr(10).join([f"{i+1}. {step}" for i, step in enumerate(template['steps'])])}

## ğŸ“Š ì˜ì–‘ ì •ë³´ (1ì¸ë¶„ ê¸°ì¤€)
- **ì¹¼ë¡œë¦¬**: {template['nutrition']['calories']}kcal
- **íƒ„ìˆ˜í™”ë¬¼**: {template['nutrition']['carbs']}g
- **ë‹¨ë°±ì§ˆ**: {template['nutrition']['protein']}g
- **ì§€ë°©**: {template['nutrition']['fat']}g

## ğŸ’¡ í‚¤í†  ì„±ê³µ íŒ
{chr(10).join([f"- {tip}" for tip in template['tips']])}

## ğŸ’¡ ë” ë‚˜ì€ ì„œë¹„ìŠ¤ë¥¼ ìœ„í•´
**ë¡œê·¸ì¸**í•˜ì‹œë©´ ì•Œë ˆë¥´ê¸°, ë¹„ì„ í˜¸ ì‹í’ˆì„ ê³ ë ¤í•œ **ë§ì¶¤í˜• ë ˆì‹œí”¼**ë¥¼ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤!"""
    
    return markdown
