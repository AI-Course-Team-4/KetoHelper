# PRD: Recipe RAG Search Engine

## 1. 프로젝트 개요

### 목적
approach4_supabase.py로 저장된 벡터 DB를 활용하여 레시피 검색 시스템의 RAG(Retrieval-Augmented Generation) 기능을 구현하고, 키워드 검색, 벡터 검색, 하이브리드 검색의 성능을 수치적으로 비교 분석

### 배경
- 기존 approach4에서 하이브리드 식재료 LLM 전처리 방식으로 레시피 데이터를 벡터화하여 Supabase에 저장
- pgvector와 Supabase를 활용한 벡터 검색 인프라 구축 완료
- 다양한 검색 방식의 성능 비교를 통한 최적 검색 전략 도출 필요

## 2. 기능 요구사항

### 2.1 핵심 기능
1. **통합 검색 (Unified Search)** ⭐ **NEW**
   - 키워드, 벡터, 하이브리드 검색을 동시에 실행
   - 각 검색 방식의 유사도 점수를 실시간으로 비교
   - 통합 결과 테이블로 모든 검색 결과를 점수 순으로 표시
   - 검색 시간 측정 및 성능 비교

2. **키워드 검색 (Keyword Search)**
   - Supabase의 full-text search 기능 활용
   - 제목, 설명, 태그, 식재료에서 키워드 매칭
   - 코사인 유사도 기반 점수 계산 (0-100%)

3. **벡터 검색 (Vector Search)**
   - OpenAI text-embedding-3-small 임베딩 활용
   - pgvector의 코사인 유사도 계산
   - 의미적 유사성 기반 검색 (0-100%)

4. **하이브리드 검색 (Hybrid Search)**
   - 키워드 검색과 벡터 검색의 가중 평균
   - 가중치 조정 가능 (예: 벡터 70% + 키워드 30%)
   - 최종 점수 계산 (0-100%)

### 2.2 검색 인터페이스
- **통합 검색 메뉴**: 3가지 검색 방식 동시 실행
- 간단한 웹 인터페이스 또는 CLI 도구
- 검색어 입력 및 결과 표시
- 각 검색 방식별 점수 및 순위 비교
- **통합 결과 테이블**: 모든 검색 결과를 점수 순으로 통합 표시

### 2.3 성능 분석
- 동일한 쿼리에 대한 3가지 검색 방식 결과 비교
- 코사인 유사도 점수 시각화
- 검색 결과의 다양성 및 정확성 분석

## 3. 기술 스택

### 3.1 백엔드
- **Python 3.11**: 메인 개발 언어
- **Supabase**: 벡터 DB 및 검색 인프라
- **pgvector**: 벡터 유사도 계산
- **OpenAI API**: 쿼리 임베딩 생성

### 3.2 프론트엔드 (선택사항)
- **FastAPI**: REST API 서버
- **HTML/CSS/JavaScript**: 간단한 웹 인터페이스

## 4. 데이터 구조

### 4.1 기존 테이블 활용
```sql
-- approach4에서 생성된 테이블 구조
hybrid_ingredient_llm_recipes:
- recipe_id: 레시피 고유 ID
- title: 레시피 제목
- structured_blob: 자연어 형태의 검색용 텍스트
- embedding: OpenAI 임베딩 벡터 (1536차원)
- llm_metadata: LLM 분석 결과
- basic_metadata: 기본 메타데이터
```

### 4.2 검색 결과 구조
```python
{
    "query": "검색어",
    "search_type": "keyword|vector|hybrid",
    "results": [
        {
            "recipe_id": "레시피 ID",
            "title": "레시피 제목",
            "similarity_score": 85.5,  # 0-100%
            "rank": 1,
            "metadata": {...}
        }
    ],
    "total_results": 10,
    "search_time_ms": 150
}
```

## 5. 구현 계획

### 5.1 Phase 1: 기본 검색 엔진 구현
- [x] 키워드 검색 함수 구현
- [x] 벡터 검색 함수 구현
- [x] 하이브리드 검색 함수 구현
- [x] 기본 CLI 테스트 도구
- [x] **통합 검색 기능 구현** ⭐ **NEW**

### 5.2 Phase 2: 성능 분석 도구
- [x] 검색 결과 비교 분석
- [x] 코사인 유사도 점수 정규화 (0-100%)
- [x] 성능 메트릭 수집
- [x] **통합 검색 결과 표시** ⭐ **NEW**

### 5.3 Phase 3: 사용자 인터페이스
- [ ] FastAPI 서버 구현
- [ ] 간단한 웹 인터페이스
- [ ] 실시간 검색 결과 비교

## 6. 성공 지표

### 6.1 기술적 지표
- 검색 응답 시간 < 500ms
- 코사인 유사도 점수 정확성 (0-100% 범위)
- 3가지 검색 방식의 결과 다양성

### 6.2 사용자 경험 지표
- 직관적인 검색 결과 비교
- 명확한 점수 표시
- 빠른 검색 응답

## 7. 위험 요소 및 대응 방안

### 7.1 기술적 위험
- **Supabase API 제한**: 요청 빈도 제한 고려
- **임베딩 비용**: OpenAI API 사용량 모니터링
- **벡터 검색 성능**: 인덱스 최적화 필요

### 7.2 대응 방안
- API 호출 최적화 및 캐싱
- 배치 처리로 비용 절감
- pgvector 인덱스 튜닝

## 8. 향후 확장 계획

### 8.1 고도화
- 개인화된 검색 가중치
- 검색 히스토리 기반 추천
- 실시간 검색 성능 모니터링

### 8.2 통합
- 기존 웹 애플리케이션과의 통합
- 모바일 앱 API 제공
- 외부 서비스 연동

---

**작성일**: 2025-09-15  
**버전**: 1.0  
**작성자**: AI Assistant
